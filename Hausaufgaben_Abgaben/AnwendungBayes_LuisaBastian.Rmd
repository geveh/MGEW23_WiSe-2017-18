---
title: "Der Satz von Bayes in den Naturgefahren"
author: "Luisa Hoße"
date: "Wintersemester 2017/18"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Megathrust-Erdbeben
Megathrust-Erdbeben sind sehr starke Erdbeben, die in Subduktionszonen auftreten, wenn auf großer Fläche aufgebaute Spannung schlagartig freigesetzt wird. Das Verhalten von Megathrust-Erdbeben auf weltweiter Skala ist ein Poisson-Prozess, die Wahrscheinlichkeit eines Starkbebens ist daher immer gleich hoch und zeitunabhängig.

Betrachtet man jedoch die Wahrscheinlichkeit des Auftretens eines Megathrust-Bebens lediglich auf einem bestimmten Abschnitt einer Störungszone muss die Abhängigkeit, u.a. von der Zeit, berücksichtigt werden. Da der Aufbau der benötigten großen Spannungen zeitintensiv ist, sinkt die Wahrscheinlichkeit für das Auftreten eines erneuten Megathrust-Erdbebens am selben Abschnitt der Störung unmittelbar nach einem solchen Ereignis stark.
Diese und andere Abhängigkeiten können bei der Berechnung der Wahrscheinlichkeit eines zukünftigen Ereignisses mittels des Satz von Bayes berücksichtigt werden,
$$\text{Posterior } p(\kappa|D) = \frac{\text{Likelihood } p(D|\kappa) * \text{Prior } p(\kappa)}{\text{Evidence } p(D)},
$$
wobei $D$ die beobachteten Daten und $\kappa$ das untersuchte Ereignis ist beziehungsweise p($D$) und p($\kappa$) die Wahrscheinlichkeiten ihres Eintretens. Sie ergibt sich aus der Verbundwahrscheinlichkeit (Wahrscheinlichkeit des gleichzeitigen Auftretens mehrerer Ereignisse) und der bedingten Wahrscheinlichkeit (Wahrscheinlichkeit für das Auftreten eines Ereignisses nach dem Eintreten eines anderen Ereignisses).


##Tool zum Satz von Bayes
```{r megathr-EQ, echo=FALSE}
fluidPage(
  sidebarLayout(
    sidebarPanel(
        numericInput("prior", label = "Prior:",
                     value = 0.5, min = 0, max = 1, step = 0.01,
                     width = NULL),
  
        sliderInput("likelihood", label = "Likelihood:",
              min = 0.0, max = 1, value = 0.5, step = 0.01)
    ),
    mainPanel(
      tabsetPanel(type = "tab",
                  tabPanel("2D Plots",
                           tags$div(
                             "Die Regel von Bayes erlaubt es, bei bedingten Wahrscheinlichkeiten die Bedingungen"
                           )
                  ),
                  tabPanel("3D Plot",
                             output$plot  <-   renderPlot({
        # install.packages("scatterplot3d") #3D plot plugin installieren (separat in Konsole ausführen)
        library(scatterplot3d) # plugin aktivieren 
        par(mfrow=c(1,1)) # nur ein Plot pro Seite
        s3d <- scatterplot3d(
          x=input$prior,
          y=input$likelihood,
          z=sum((input$likelihood*input$prior),((1-input$likelihood)*(1-input$prior))),
          type="h", pch=16, angle=45, grid = TRUE,
          xlab="Prior",
          ylab="Likelihood",
          zlab="Posterior",
          color = "blue",
          xlim=c(0,1),
          ylim=c(0,1),
          zlim=c(0,1),
          main="Prior, Likelihood und Posterior", 
          tick.marks=TRUE, #?
          label.tick.marks = TRUE #?,
          )
                           )
                  )
      )
    )
  )
)
                           
      
      
      
      
      
       #output$text <- renderText({  
       #paste("Die Wahrscheinlichkeit beträgt",sum((input$likelihood*input$prior),((1-input$likelihood)*(1-input$prior))),".")
         
       #})
      
      #interaktiven 3D plot einfügen
      output$plot  <-   renderPlot({
        # install.packages("scatterplot3d") #3D plot plugin installieren (separat in Konsole ausführen)
        library(scatterplot3d) # plugin aktivieren 
        par(mfrow=c(1,1)) # nur ein Plot pro Seite
        s3d <- scatterplot3d(
          x=input$prior,
          y=input$likelihood,
          z=sum((input$likelihood*input$prior),((1-input$likelihood)*(1-input$prior))),
          type="h", pch=16, angle=45, grid = TRUE,
          xlab="Prior",
          ylab="Likelihood",
          zlab="Posterior",
          color = "blue",
          xlim=c(0,1),
          ylim=c(0,1),
          zlim=c(0,1),
          main="Prior, Likelihood und Posterior", 
          tick.marks=TRUE, #?
          label.tick.marks = TRUE #?,
          )
        
        #plane in Plot einfuegen
        #flaeche <- lm(input$prior~
        #                input$likelihood +
        #        sum((input$likelihood*input$prior),((1-input$likelihood)*(1-input$prior)))
         #           )
        
        #Steigung der Plane
        #flaeche <- lm(c(0.5,0.2) ~ c(0.2,0.4) + c(0.6,0.8))
        #s3d$plane3d(flaeche)
        
        ###Punkte einfuegen
        #tabelle mit datenpunkten erstellen, posterior ist nur platzhalter
        punkte <- data.frame(prior=seq(0,1,by=0.01),likelihood=seq(0,1,by=0.01),posterior=seq(0,1,by=0.01))
        
        #posterior fuellen
        i <- 1
        for(i in 1:100) { 
              punkte$posterior[i] <-  sum((punkte$likelihood[i]*punkte$prior[i]),
                                          ((1-punkte$likelihood[i])*(1-punkte$prior[i])))
                        }
        #punkte einsetzen
        s3d$points3d(punkte,
                     type = 'h',
                     lty = 1)
        
        })
       )
  )
)
  


  
#textOutput("posterior", container = prior )
```




#### Verbesserungsmöglichkeiten
  - Der Zusammenhang zwischen Megathrust-Erdbeben und dem Tool zum Satz von Bayes könnte klarer herausgearbeitet werden.
  - Eine grafische Darstellung bei der Exploration der im Satz von Bayes dargestellten Zusammenhänge wäre hilfreich. Ein 3D Plot ermöglicht es, auf der x- und der y-Achse den Likelihood-Wert beziehungsweise den Prior-Wert darzustellen, sodass auf der z-Achse der entsprechende Posterior-Wert abgelesen oder interaktiv ausgewählt und angezeigt werden kann. Alternativ ließe sich ein 3D-Graph mit einer Farbskala für den Posterior-Wert implementieren.
  - Des Weiteren trüge die Vereinheitlichung der Sprache oder die Gegenüberstellung der englischen und deutschen Fachbegriffe zu einem besseren Verständnis bei.
    
#### Quellen
  - Vorlesung _Seismic Hazards_ von Fabrice Cotton (Deutsches GeoForschungsZentrum und Uni Potsdam)
  - https://stackoverflow.com/questions/27121665/get-value-from-reactive-context-in-r-shiny-based-on-user-input
  - Mittal, H.V., 2011, _R Graphs Cookbook_, Packt Publishing

